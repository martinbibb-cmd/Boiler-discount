<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Boiler Discount Finder</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: Arial, Helvetica, sans-serif;
      background: #f0f4f8;
      color: #222;
      min-height: 100vh;
    }

    header {
      background: #1a4a8a;
      color: #fff;
      padding: 20px 24px;
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
    }

    .header-text h1 {
      font-size: 1.6rem;
      font-weight: 700;
    }

    .header-text p {
      margin-top: 4px;
      font-size: 0.95rem;
      opacity: 0.85;
    }

    .more-btn {
      background: rgba(255,255,255,0.18);
      border: 1px solid rgba(255,255,255,0.5);
      color: #fff;
      padding: 7px 16px;
      border-radius: 20px;
      font-size: 0.88rem;
      font-weight: 600;
      cursor: pointer;
      white-space: nowrap;
      flex-shrink: 0;
      margin-left: 16px;
      transition: background 0.15s;
    }

    .more-btn:hover {
      background: rgba(255,255,255,0.30);
    }

    /* Modal */
    .modal-backdrop {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.45);
      z-index: 100;
      align-items: center;
      justify-content: center;
    }

    .modal-backdrop.open {
      display: flex;
    }

    .modal {
      background: #fff;
      border-radius: 12px;
      padding: 32px 28px 24px;
      max-width: 420px;
      width: calc(100% - 32px);
      box-shadow: 0 8px 32px rgba(0,0,0,0.18);
      position: relative;
    }

    .modal-close {
      position: absolute;
      top: 12px;
      right: 16px;
      background: none;
      border: none;
      font-size: 1.4rem;
      color: #888;
      cursor: pointer;
      line-height: 1;
    }

    .modal-close:hover { color: #333; }

    .modal ul {
      list-style: disc;
      padding-left: 20px;
      margin: 0 0 24px;
      color: #333;
      line-height: 1.75;
      font-size: 0.97rem;
    }

    .email-btn {
      display: block;
      width: 100%;
      background: #1a4a8a;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 12px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      text-align: center;
      text-decoration: none;
      transition: background 0.15s;
    }

    .email-btn:hover { background: #163d75; }

    main {
      max-width: 960px;
      margin: 28px auto;
      padding: 0 16px 40px;
    }

    .filters {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      background: #fff;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      margin-bottom: 24px;
    }

    .filter-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
      flex: 1;
      min-width: 180px;
    }

    .filter-group label {
      font-size: 0.85rem;
      font-weight: 600;
      color: #555;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }

    .filter-group select {
      padding: 9px 12px;
      border: 1px solid #ccd6e0;
      border-radius: 6px;
      font-size: 0.95rem;
      background: #f9fbfd;
      cursor: pointer;
      color: #222;
    }

    .filter-group select:focus {
      outline: 2px solid #1a4a8a;
      outline-offset: 1px;
    }

    .results-info {
      font-size: 0.9rem;
      color: #555;
      margin-bottom: 10px;
    }

    .results-info strong {
      color: #1a4a8a;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }

    thead {
      background: #1a4a8a;
      color: #fff;
    }

    thead th {
      padding: 13px 16px;
      text-align: left;
      font-size: 0.88rem;
      font-weight: 600;
      letter-spacing: 0.03em;
      text-transform: uppercase;
    }

    tbody tr {
      border-bottom: 1px solid #e8ecf0;
      transition: background 0.15s;
    }

    tbody tr:last-child { border-bottom: none; }
    tbody tr:hover { background: #f0f6ff; }

    tbody td {
      padding: 12px 16px;
      font-size: 0.93rem;
    }

    .type-badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 0.78rem;
      font-weight: 600;
    }

    .type-combi   { background: #dbeafe; color: #1e40af; }
    .type-system  { background: #d1fae5; color: #065f46; }
    .type-regular { background: #fef3c7; color: #92400e; }

    .discount {
      font-weight: 700;
      color: #047857;
    }

    .code {
      font-family: monospace;
      font-size: 0.88rem;
      color: #555;
    }

    .no-results {
      text-align: center;
      padding: 40px 16px;
      color: #777;
      font-size: 1rem;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }

    /* ── Current Boiler Block ───────────────────────── */
    .current-boiler-block {
      background: #fff;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      margin-bottom: 24px;
    }

    .section-title {
      font-size: 0.85rem;
      font-weight: 700;
      color: #1a4a8a;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      margin-bottom: 14px;
    }

    .cbb-inputs {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
    }

    .cbb-inputs .filter-group {
      flex: 1;
      min-width: 160px;
    }

    .range-row {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .range-row input[type="range"] {
      flex: 1;
      accent-color: #1a4a8a;
      cursor: pointer;
    }

    .range-val {
      font-size: 0.82rem;
      font-weight: 600;
      color: #1a4a8a;
      min-width: 38px;
      text-align: right;
    }

    .efficiency-result {
      margin-top: 16px;
      padding: 12px 16px;
      background: #f0f4f8;
      border-radius: 6px;
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .eff-label { font-size: 0.9rem; color: #555; }

    .eff-value { font-size: 1.4rem; font-weight: 700; }
    .eff-good  { color: #047857; }
    .eff-warn  { color: #b45309; }
    .eff-bad   { color: #b91c1c; }

    .eff-note {
      font-size: 0.78rem;
      color: #777;
      flex-basis: 100%;
      margin-top: 2px;
    }

    /* ── Pressure Display ───────────────────────────── */
    .pressure-inputs {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      align-items: flex-end;
    }

    .pressure-inputs .filter-group input[type="number"] {
      padding: 9px 12px;
      border: 1px solid #ccd6e0;
      border-radius: 6px;
      font-size: 0.95rem;
      background: #f9fbfd;
      color: #222;
      width: 100%;
    }

    .pressure-inputs .filter-group input[type="number"]:focus {
      outline: 2px solid #1a4a8a;
      outline-offset: 1px;
    }

    .pressure-result {
      flex: 2;
      min-width: 240px;
      padding-bottom: 4px;
    }

    .pdrop-line {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .pdrop-arrow  { font-size: 0.95rem; font-weight: 600; color: #333; }

    .pdrop-badge {
      display: inline-block;
      padding: 3px 10px;
      border-radius: 12px;
      font-size: 0.8rem;
      font-weight: 600;
    }

    .pdrop-good    { background: #d1fae5; color: #065f46; }
    .pdrop-ok      { background: #dbeafe; color: #1e40af; }
    .pdrop-warn    { background: #fef3c7; color: #92400e; }
    .pdrop-bad     { background: #fee2e2; color: #991b1b; }
    .pdrop-invalid { font-size: 0.85rem; color: #991b1b; }

    /* ── Architecture info strip ────────────────────── */
    .arch-info {
      margin-top: 10px;
      padding: 8px 12px;
      background: #f0f6ff;
      border-radius: 6px;
      border-left: 3px solid #1a4a8a;
      font-size: 0.82rem;
      color: #444;
      line-height: 1.6;
    }

    .arch-info strong { color: #1a4a8a; }
  </style>
</head>
<body>

<header>
  <div class="header-text">
    <h1>Boiler Discount Finder</h1>
    <p>Select a brand, boiler type and output (kW) to find available discounts.</p>
  </div>
  <button class="more-btn" id="moreBtn">More?</button>
</header>

<div class="modal-backdrop" id="modalBackdrop" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
  <div class="modal">
    <button class="modal-close" id="modalClose" aria-label="Close">&times;</button>
    <h2 id="modalTitle" style="font-size:1rem;font-weight:700;color:#1a4a8a;margin-bottom:16px;">Get in touch</h2>
    <ul>
      <li>Found this useful? Got another idea? Email me.</li>
      <li>Need something similar? Let me know.</li>
      <li>Got another workflow headache? I like fixing those.</li>
    </ul>
    <a class="email-btn" href="mailto:martin.bibb@britishgas.co.uk">✉ Get in touch</a>
  </div>
</div>

<main>

  <!-- ── Current Boiler Efficiency Block ────────────── -->
  <div class="current-boiler-block">
    <p class="section-title">Current Boiler — Real Operating Efficiency</p>
    <div class="cbb-inputs">
      <div class="filter-group">
        <label for="sedbukInput">SEDBUK Rating (%)</label>
        <div class="range-row">
          <input type="range" id="sedbukInput" min="70" max="96" value="84" step="1">
          <span class="range-val" id="sedbukVal">84%</span>
        </div>
      </div>
      <div class="filter-group">
        <label for="ageInput">Boiler Age (years)</label>
        <div class="range-row">
          <input type="range" id="ageInput" min="0" max="20" value="10" step="1">
          <span class="range-val" id="ageVal">10 yrs</span>
        </div>
      </div>
      <div class="filter-group">
        <label for="flowTempInput">Flow Temperature</label>
        <select id="flowTempInput">
          <option value="condensing">≤55 °C — fully condensing</option>
          <option value="partial" selected>60–70 °C — partial condensing</option>
          <option value="none">≥75 °C — not condensing</option>
        </select>
      </div>
      <div class="filter-group">
        <label for="scaleInput">Scale / Magnetite</label>
        <select id="scaleInput">
          <option value="none">None</option>
          <option value="light">Light</option>
          <option value="heavy">Heavy</option>
        </select>
      </div>
    </div>
    <div class="efficiency-result">
      <span class="eff-label">Estimated real operating efficiency:</span>
      <span class="eff-value eff-warn" id="realEff">—</span>
      <span class="eff-note" id="effNote"></span>
    </div>
  </div>

  <!-- ── Discount Finder Filters ───────────────────── -->
  <div class="filters">
    <div class="filter-group">
      <label for="brandFilter">Brand</label>
      <select id="brandFilter">
        <option value="">All Brands</option>
      </select>
    </div>
    <div class="filter-group">
      <label for="typeFilter">System Type</label>
      <select id="typeFilter">
        <option value="">All Types</option>
        <option value="Combi">Combi — On-Demand DHW (Sealed)</option>
        <option value="System">System — Stored Cylinder (Sealed)</option>
        <option value="Regular">Regular — Open Vented + Cylinder</option>
      </select>
    </div>
    <div class="filter-group">
      <label for="powerFilter">Output (kW)</label>
      <select id="powerFilter">
        <option value="">All Outputs</option>
      </select>
    </div>
  </div>

  <!-- ── Architecture Info Strip ───────────────────── -->
  <div class="arch-info" id="archInfo" style="display:none;margin-bottom:16px;"></div>

  <!-- ── Pressure Monitor ──────────────────────────── -->
  <div class="current-boiler-block" style="margin-bottom:24px;">
    <p class="section-title">Supply Pressure Monitor</p>
    <div class="pressure-inputs">
      <div class="filter-group" style="max-width:180px;">
        <label for="staticPressure">Static Pressure (bar)</label>
        <input type="number" id="staticPressure" step="0.1" min="0" max="6" placeholder="e.g. 3.2">
      </div>
      <div class="filter-group" style="max-width:180px;">
        <label for="dynamicPressure">Dynamic Pressure (bar)</label>
        <input type="number" id="dynamicPressure" step="0.1" min="0" max="6" placeholder="e.g. 2.0">
      </div>
      <div class="pressure-result" id="pressureResult"></div>
    </div>
  </div>

  <p class="results-info" id="resultsInfo"></p>

  <div id="resultsContainer"></div>
</main>

<script>
// Boiler data: { brand, model, code, type, power (kW), discount (pence) }
const BOILERS = [
  // Glowworm Energy7
  { brand: "Glowworm",       model: "Glowworm Energy7 12r Regular",            code: "CBLR3375", type: "Regular", power: 12,  discount: 100  },
  { brand: "Glowworm",       model: "Glowworm Energy7 15r Regular",            code: "CBLR3376", type: "Regular", power: 15,  discount: 50   },
  { brand: "Glowworm",       model: "Glowworm Energy7 18r Regular",            code: "CBLR3377", type: "Regular", power: 18,  discount: 100  },
  { brand: "Glowworm",       model: "Glowworm Energy7 18s System ErP",         code: "CBLR3380", type: "System",  power: 18,  discount: 50   },
  { brand: "Glowworm",       model: "Glowworm Energy7 25c ErP",                code: "CBLR3382", type: "Combi",   power: 25,  discount: 50   },
  { brand: "Glowworm",       model: "Glowworm Energy7 25r Regular",            code: "CBLR3378", type: "Regular", power: 25,  discount: 100  },
  { brand: "Glowworm",       model: "Glowworm Energy7 25s System ErP",         code: "CBLR3381", type: "System",  power: 25,  discount: 50   },
  { brand: "Glowworm",       model: "Glowworm Energy7 30c ErP",                code: "CBLR3383", type: "Combi",   power: 30,  discount: 50   },
  { brand: "Glowworm",       model: "Glowworm Energy7 30r Regular",            code: "CBLR3379", type: "Regular", power: 30,  discount: 100  },
  { brand: "Glowworm",       model: "Glowworm Energy7 35c ErP",                code: "CBLR3384", type: "Combi",   power: 35,  discount: 150  },

  // Worcester Bosch Greenstar 8000 F
  { brand: "Worcester Bosch", model: "Worcester Bosch Greenstar 8000 F 35kW Combi NG", code: "CBLR3592", type: "Combi",   power: 35,  discount: 50  },
  { brand: "Worcester Bosch", model: "Worcester Bosch Greenstar 8000 F 50kW Combi NG", code: "CBLR3593", type: "Combi",   power: 50,  discount: 50  },

  // Worcester Greenstar 4000 (standalone combi entry)
  { brand: "Worcester Bosch", model: "Greenstar 4000 30kW Combi NG",            code: "CBLR3602", type: "Combi",   power: 30,  discount: 100  },

  // Ideal Logic Combi2
  { brand: "Ideal",          model: "IDEAL LOGIC COMBI2 C24 BOILER",           code: "CBLR1912", type: "Combi",   power: 24,  discount: 300  },
  { brand: "Ideal",          model: "IDEAL LOGIC COMBI2 C30 BOILER",           code: "CBLR1913", type: "Combi",   power: 30,  discount: 300  },
  { brand: "Ideal",          model: "IDEAL LOGIC COMBI2 C35 BOILER",           code: "CBLR1914", type: "Combi",   power: 35,  discount: 300  },

  // Ideal Logic Heat2 (Regular / heat only)
  { brand: "Ideal",          model: "IDEAL LOGIC HEAT2 H12 BOILER",            code: "CBLR1919", type: "Regular", power: 12,  discount: 200  },
  { brand: "Ideal",          model: "IDEAL LOGIC HEAT2 H15 BOILER",            code: "CBLR1920", type: "Regular", power: 15,  discount: 200  },
  { brand: "Ideal",          model: "IDEAL LOGIC HEAT2 H18 BOILER",            code: "CBLR1921", type: "Regular", power: 18,  discount: 150  },
  { brand: "Ideal",          model: "IDEAL LOGIC HEAT2 H24 BOILER",            code: "CBLR1922", type: "Regular", power: 24,  discount: 300  },
  { brand: "Ideal",          model: "IDEAL LOGIC HEAT2 H30 BOILER",            code: "CBLR1923", type: "Regular", power: 30,  discount: 300  },

  // Ideal Logic System
  { brand: "Ideal",          model: "Ideal Logic System Boiler 24kW",          code: "CBLR1917", type: "System",  power: 24,  discount: 100  },

  // Ideal Logic System2
  // Note: CBLR1917 appears twice in the source data (above entry and S24 below) — retained as supplied.
  { brand: "Ideal",          model: "IDEAL LOGIC SYSTEM2 S15 BOILER",          code: "CBLR1915", type: "System",  power: 15,  discount: 50   },
  { brand: "Ideal",          model: "IDEAL LOGIC SYSTEM2 S18 BOILER",          code: "CBLR1916", type: "System",  power: 18,  discount: 50   },
  { brand: "Ideal",          model: "IDEAL LOGIC SYSTEM2 S24 BOILER",          code: "CBLR1917", type: "System",  power: 24,  discount: 50   },
  { brand: "Ideal",          model: "IDEAL LOGIC SYSTEM2 S30 BOILER",          code: "CBLR1918", type: "System",  power: 30,  discount: 300  },

  // Keston
  { brand: "Keston",         model: "Keston System 2 S30 System Boiler",       code: "CBLR3002", type: "System",  power: 30,  discount: 100  },

  // Vaillant ecoFIT pure — 4xx = Regular, 6xx = System, 8xx = Combi; last 2 digits = kW
  { brand: "Vaillant",       model: "Vaillant ecoFIT pure 412",                code: "CBLR3423", type: "Regular", power: 12,  discount: 100  },
  { brand: "Vaillant",       model: "Vaillant ecoFIT pure 415",                code: "CBLR3424", type: "Regular", power: 15,  discount: 300  },
  { brand: "Vaillant",       model: "Vaillant ecoFIT pure 418",                code: "CBLR3425", type: "Regular", power: 18,  discount: 300  },
  { brand: "Vaillant",       model: "Vaillant ecoFIT pure 425",                code: "CBLR3426", type: "Regular", power: 25,  discount: 200  },
  { brand: "Vaillant",       model: "Vaillant ecoFIT pure 430",                code: "CBLR3427", type: "Regular", power: 30,  discount: 300  },
  { brand: "Vaillant",       model: "Vaillant ecoFIT pure 435",                code: "CBLR3428", type: "Regular", power: 35,  discount: 300  },
  { brand: "Vaillant",       model: "Vaillant ecoFIT pure 612",                code: "CBLR3429", type: "System",  power: 12,  discount: 100  },
  { brand: "Vaillant",       model: "Vaillant ecoFIT pure 615",                code: "CBLR3430", type: "System",  power: 15,  discount: 100  },
  { brand: "Vaillant",       model: "Vaillant ecoFIT pure 618",                code: "CBLR3431", type: "System",  power: 18,  discount: 50   },
  { brand: "Vaillant",       model: "Vaillant ecoFIT pure 625",                code: "CBLR3432", type: "System",  power: 25,  discount: 50   },
  { brand: "Vaillant",       model: "Vaillant ecoFIT pure 630",                code: "CBLR3433", type: "System",  power: 30,  discount: 150  },
  { brand: "Vaillant",       model: "Vaillant ecoFIT pure 825",                code: "CBLR3420", type: "Combi",   power: 25,  discount: 50   },
  { brand: "Vaillant",       model: "Vaillant ecoFIT pure 830",                code: "CBLR3421", type: "Combi",   power: 30,  discount: 100  },
  { brand: "Vaillant",       model: "Vaillant ecoFIT pure 835",                code: "CBLR3422", type: "Combi",   power: 35,  discount: 300  },

  // Vaillant ecoTEC plus — 4xx = Regular; last 2 digits = kW
  { brand: "Vaillant",       model: "Vaillant ecoTEC plus 412 MkII",           code: "CBLR3390", type: "Regular", power: 12,  discount: 100  },
  { brand: "Vaillant",       model: "Vaillant ecoTEC plus 415 MkII",           code: "CBLR3391", type: "Regular", power: 15,  discount: 100  },
  { brand: "Vaillant",       model: "Vaillant ecoTEC plus 418 MkII",           code: "CBLR3392", type: "Regular", power: 18,  discount: 150  },
  { brand: "Vaillant",       model: "Vaillant ecoTEC plus 424 MkII",           code: "CBLR3393", type: "Regular", power: 24,  discount: 200  },
  { brand: "Vaillant",       model: "Vaillant ecoTEC plus 430 MkII",           code: "CBLR3394", type: "Regular", power: 30,  discount: 300  },

  // Vaillant ecoTEC pro (Combi)
  { brand: "Vaillant",       model: "Vaillant ecoTEC pro 24",                  code: "CBLR3439", type: "Combi",   power: 24,  discount: 50   },
  { brand: "Vaillant",       model: "Vaillant ecoTEC pro 28",                  code: "CBLR3440", type: "Combi",   power: 28,  discount: 50   },
  { brand: "Vaillant",       model: "Vaillant ecoTEC pro 30 ErP",              code: "CBLR3385", type: "Combi",   power: 30,  discount: 50   },

  // Viessmann Vitodens
  { brand: "Viessmann",      model: "Viessmann Vitodens 050-W 25kW System Boiler B0HA", code: "CBLR6514", type: "System",  power: 25,  discount: 50   },
  { brand: "Viessmann",      model: "Viessmann Vitodens 050-W 30kW Combi B0KA",         code: "CBLR6511", type: "Combi",   power: 30,  discount: 50   },
  { brand: "Viessmann",      model: "Viessmann Vitodens 050-W 35kW Combi B0KA",         code: "CBLR6512", type: "Combi",   power: 35,  discount: 50   },
  { brand: "Viessmann",      model: "Viessmann Vitodens 100-W 19kW Heat Only B1GA",     code: "CBLR6520", type: "Regular", power: 19,  discount: 200  },
  { brand: "Viessmann",      model: "Viessmann Vitodens 100-W 25kW Heat Only B1GA",     code: "CBLR6521", type: "Regular", power: 25,  discount: 300  },
  { brand: "Viessmann",      model: "Viessmann Vitodens 100-W 30kW Combi Boiler B1KF",  code: "CBLR6516", type: "Combi",   power: 30,  discount: 150  },
  { brand: "Viessmann",      model: "Viessmann Vitodens 100-W 32kW Heat Only B1GA",     code: "CBLR6522", type: "Regular", power: 32,  discount: 100  },
  { brand: "Viessmann",      model: "Viessmann Vitodens 100-W 32kW System Boiler B1HF", code: "CBLR6526", type: "System",  power: 32,  discount: 150  },

  // Worcester Greenstar (various)
  { brand: "Worcester Bosch", model: "Worcester Greenstar 25Si Compact ErP",    code: "CBLR1366", type: "System",  power: 25,  discount: 50   },
  { brand: "Worcester Bosch", model: "Worcester Greenstar 28CDi Compact",       code: "CBLR3459", type: "Combi",   power: 28,  discount: 50   },
  { brand: "Worcester Bosch", model: "Worcester Greenstar 30Ri ErP",            code: "CBLR1380", type: "Regular", power: 30,  discount: 150  },
  { brand: "Worcester Bosch", model: "Worcester Greenstar 30Ri ErP LPG",        code: "CBLR1381", type: "Regular", power: 30,  discount: 100  },
  { brand: "Worcester Bosch", model: "Worcester Greenstar 32CDi Compact",       code: "CBLR3446", type: "Combi",   power: 32,  discount: 100  },
  { brand: "Worcester Bosch", model: "Worcester Greenstar 32CDi Compact ErP LPG", code: "CBLR1370", type: "Combi", power: 32,  discount: 50   },
  { brand: "Worcester Bosch", model: "Worcester Greenstar 36CDi Compact",       code: "CBLR3447", type: "Combi",   power: 36,  discount: 100  },
  { brand: "Worcester Bosch", model: "Worcester Greenstar 4000 15kW System NG", code: "CBLR3606", type: "System",  power: 15,  discount: 50   },
  { brand: "Worcester Bosch", model: "Worcester Greenstar 4000 18kW System NG", code: "CBLR3608", type: "System",  power: 18,  discount: 50   },
  { brand: "Worcester Bosch", model: "Worcester Greenstar 4000 21kW System NG", code: "CBLR3610", type: "System",  power: 21,  discount: 50   },
  { brand: "Worcester Bosch", model: "Worcester Greenstar 4000 24kW System LPG",code: "CBLR3613", type: "System",  power: 24,  discount: 50   },
  { brand: "Worcester Bosch", model: "Worcester Greenstar 4000 24kW System NG", code: "CBLR3612", type: "System",  power: 24,  discount: 50   },
  { brand: "Worcester Bosch", model: "Worcester Greenstar 4000 25kW Combi LPG", code: "CBLR3601", type: "Combi",   power: 25,  discount: 50   },
  { brand: "Worcester Bosch", model: "Worcester Greenstar 4000 25kW Combi NG",  code: "CBLR3600", type: "Combi",   power: 25,  discount: 50   },
  { brand: "Worcester Bosch", model: "Worcester Greenstar 4000 30kW Combi LPG", code: "CBLR3603", type: "Combi",   power: 30,  discount: 50   },
  { brand: "Worcester Bosch", model: "Worcester Greenstar 8000 Life 30kW Regular", code: "",      type: "Regular", power: 30,  discount: 50   },
  { brand: "Worcester Bosch", model: "Worcester Greenstar 8000 Life 40kW Combi",   code: "CBLR3530", type: "Combi",   power: 40,  discount: 50   },
  { brand: "Worcester Bosch", model: "Worcester Greenstar 8000+ 30kW Regular NG",  code: "CBLR3574", type: "Regular", power: 30,  discount: 50   },
  { brand: "Worcester Bosch", model: "Worcester Greenstar 8000+ 30kW System LPG",  code: "CBLR3579", type: "System",  power: 30,  discount: 50   },
  { brand: "Worcester Bosch", model: "Worcester Greenstar 8000+ 30kW System NG",   code: "CBLR3572", type: "System",  power: 30,  discount: 50   },
  { brand: "Worcester Bosch", model: "Worcester Greenstar 8000+ 32kW Combi LPG",   code: "CBLR3567", type: "Combi",   power: 32,  discount: 50   },
  { brand: "Worcester Bosch", model: "Worcester Greenstar 8000+ 35kW Regular LPG", code: "CBLR3582", type: "Regular", power: 35,  discount: 100  },
  { brand: "Worcester Bosch", model: "Worcester Greenstar 8000+ 35kW Regular NG",  code: "CBLR3575", type: "Regular", power: 35,  discount: 50   },
  { brand: "Worcester Bosch", model: "Worcester Greenstar 8000+ 35kW System NG",   code: "CBLR3573", type: "System",  power: 35,  discount: 50   },
  { brand: "Worcester Bosch", model: "Worcester Greenstar 8000+ 36kW Combi LPG",   code: "CBLR3568", type: "Combi",   power: 36,  discount: 50   },
  { brand: "Worcester Bosch", model: "Worcester Greenstar 8000+ 36kW Combi NG",    code: "CBLR3561", type: "Combi",   power: 36,  discount: 50   },
  { brand: "Worcester Bosch", model: "Worcester Greenstar 8000+ 40kW Combi LPG",   code: "CBLR3569", type: "Combi",   power: 40,  discount: 100  },
  { brand: "Worcester Bosch", model: "Worcester Greenstar 8000+ 40kW Combi NG",    code: "CBLR3562", type: "Combi",   power: 40,  discount: 50   },
  { brand: "Worcester Bosch", model: "Worcester Greenstar 8000+ 40kW Regular NG",  code: "CBLR3576", type: "Regular", power: 40,  discount: 100  },
  { brand: "Worcester Bosch", model: "Worcester Greenstar 8000+ 45kW Combi NG",    code: "CBLR3563", type: "Combi",   power: 45,  discount: 100  },
  { brand: "Worcester Bosch", model: "Worcester Greenstar 8000+ 45kW Regular NG",  code: "CBLR3577", type: "Regular", power: 45,  discount: 50   },
  { brand: "Worcester Bosch", model: "Worcester Greenstar 8000+ 50kW Regular NG",  code: "CBLR3578", type: "Regular", power: 50,  discount: 300  },
  { brand: "Worcester Bosch", model: "Worcester Greenstar 8000+ Style 32kW Combi NG", code: "CBLR3565", type: "Combi", power: 32, discount: 50  },
  { brand: "Worcester Bosch", model: "Worcester Greenstar 8000+ Style 36kW Combi NG", code: "CBLR3566", type: "Combi", power: 36, discount: 50  },
  { brand: "Worcester Bosch", model: "Worcester Greenstar FS 30CDi ErP",           code: "CBLR1388", type: "Combi",   power: 30,  discount: 50   },
  { brand: "Worcester Bosch", model: "Worcester Greenstar Ri 12kW MK11",           code: "CBLR3453", type: "Regular", power: 12,  discount: 50   },
  { brand: "Worcester Bosch", model: "Worcester Greenstar Ri 15kW LPG MK11",       code: "CBLR3456", type: "Regular", power: 15,  discount: 50   },
  { brand: "Worcester Bosch", model: "Worcester Greenstar Ri 15kW MK11",           code: "CBLR3455", type: "Regular", power: 15,  discount: 50   },
  { brand: "Worcester Bosch", model: "Worcester Greenstar Ri 18kW LPG MK11",       code: "CBLR3458", type: "Regular", power: 18,  discount: 100  },
  { brand: "Worcester Bosch", model: "Worcester Greenstar Ri 18kW MK11",           code: "CBLR3457", type: "Regular", power: 18,  discount: 50   },
  { brand: "Worcester Bosch", model: "Worcester Greenstar Ri 24kW LPG MK11",       code: "CBLR3462", type: "Regular", power: 24,  discount: 100  },
  { brand: "Worcester Bosch", model: "Worcester Greenstar Ri 24kW MK11",           code: "CBLR3461", type: "Regular", power: 24,  discount: 200  },
];

function formatDiscount(pounds) {
  return '£' + pounds.toFixed(2);
}

function getFilteredBoilers(brand, type, power) {
  return BOILERS.filter(b => {
    if (brand && b.brand !== brand) return false;
    if (type && b.type !== type) return false;
    if (power && b.power !== Number(power)) return false;
    return true;
  });
}

function getAvailableBrands() {
  const brands = [...new Set(BOILERS.map(b => b.brand))].sort();
  return brands;
}

function getAvailablePowers(brand, type) {
  let filtered = BOILERS;
  if (brand) filtered = filtered.filter(b => b.brand === brand);
  if (type)  filtered = filtered.filter(b => b.type  === type);
  const powers = [...new Set(filtered.map(b => b.power))].sort((a, b) => a - b);
  return powers;
}

function render() {
  const brand = document.getElementById('brandFilter').value;
  const type  = document.getElementById('typeFilter').value;
  const power = document.getElementById('powerFilter').value;

  // Populate brand dropdown on first render
  const brandSelect = document.getElementById('brandFilter');
  if (brandSelect.options.length === 1) {
    getAvailableBrands().forEach(br => {
      const opt = document.createElement('option');
      opt.value = br;
      opt.textContent = br;
      brandSelect.appendChild(opt);
    });
    brandSelect.value = brand;
  }

  // Update power options based on selected brand and type
  const powerSelect = document.getElementById('powerFilter');
  const currentPower = powerSelect.value;
  const availablePowers = getAvailablePowers(brand, type);

  powerSelect.innerHTML = '<option value="">All Outputs</option>';
  availablePowers.forEach(p => {
    const opt = document.createElement('option');
    opt.value = p;
    opt.textContent = p + ' kW';
    if (String(p) === currentPower) opt.selected = true;
    powerSelect.appendChild(opt);
  });

  // Re-read power after options refresh
  const selectedPower = powerSelect.value;

  const results = getFilteredBoilers(brand, type, selectedPower);

  document.getElementById('resultsInfo').innerHTML =
    `Showing <strong>${results.length}</strong> boiler${results.length !== 1 ? 's' : ''}` +
    (brand ? ` &ndash; <strong>${brand}</strong>` : '') +
    (type  ? ` &ndash; <strong>${type}</strong>` : '') +
    (selectedPower ? ` &ndash; <strong>${selectedPower} kW</strong>` : '');

  const container = document.getElementById('resultsContainer');

  if (results.length === 0) {
    container.innerHTML = '<div class="no-results">No boilers found matching the selected filters.</div>';
    return;
  }

  const typeClass = { Combi: 'type-combi', System: 'type-system', Regular: 'type-regular' };

  const rows = results.map(b => `
    <tr>
      <td>${b.model}</td>
      <td><span class="type-badge ${typeClass[b.type]}">${b.type}</span></td>
      <td class="code">${b.code || '<span style="color:#aaa">N/A</span>'}</td>
      <td class="discount">${formatDiscount(b.discount)}</td>
    </tr>`).join('');

  container.innerHTML = `
    <table>
      <thead>
        <tr>
          <th>Boiler Model</th>
          <th>Type</th>
          <th>Code</th>
          <th>Discount</th>
        </tr>
      </thead>
      <tbody>${rows}</tbody>
    </table>`;
}

document.getElementById('brandFilter').addEventListener('change', render);
document.getElementById('typeFilter').addEventListener('change', render);
document.getElementById('powerFilter').addEventListener('change', render);

// ── Architecture info strip ────────────────────────────────────────────────
const ARCH_INFO = {
  Combi:   '<strong>Heat Source:</strong> Gas Boiler &nbsp;|&nbsp; <strong>Heating:</strong> Sealed System &nbsp;|&nbsp; <strong>Hot Water:</strong> On Demand',
  System:  '<strong>Heat Source:</strong> Gas Boiler &nbsp;|&nbsp; <strong>Heating:</strong> Sealed System &nbsp;|&nbsp; <strong>Hot Water:</strong> Stored Cylinder (Unvented)',
  Regular: '<strong>Heat Source:</strong> Gas Boiler &nbsp;|&nbsp; <strong>Heating:</strong> Open Vented &nbsp;|&nbsp; <strong>Hot Water:</strong> Stored Cylinder (Vented)',
};

document.getElementById('typeFilter').addEventListener('change', function () {
  const archEl = document.getElementById('archInfo');
  const type = this.value;
  if (type && ARCH_INFO[type]) {
    archEl.innerHTML = ARCH_INFO[type];
    archEl.style.display = 'block';
  } else {
    archEl.style.display = 'none';
  }
});

// ── Current Boiler Efficiency Calculator ──────────────────────────────────
function calcRealEfficiency() {
  const sedbuk   = parseFloat(document.getElementById('sedbukInput').value);
  const age      = parseFloat(document.getElementById('ageInput').value);
  const flowTemp = document.getElementById('flowTempInput').value;
  const scale    = document.getElementById('scaleInput').value;

  document.getElementById('sedbukVal').textContent = sedbuk + '%';
  document.getElementById('ageVal').textContent    = age + ' yr' + (age !== 1 ? 's' : '');

  // age decay: ~0.4 % per year, floor at 80 % of rated
  const ageFactor   = Math.max(0.80, 1 - age * 0.004);
  const flowFactor  = flowTemp === 'condensing' ? 1.00 : flowTemp === 'partial' ? 0.95 : 0.88;
  const scaleFactor = scale === 'none' ? 1.00 : scale === 'light' ? 0.97 : 0.93;

  const real = sedbuk * ageFactor * flowFactor * scaleFactor;

  const el   = document.getElementById('realEff');
  el.textContent = real.toFixed(1) + '%';
  el.className   = 'eff-value ' + (real >= 85 ? 'eff-good' : real >= 75 ? 'eff-warn' : 'eff-bad');

  const notes = [];
  if (ageFactor < 1)    notes.push('age penalty ×' + ageFactor.toFixed(3));
  if (flowFactor < 1)   notes.push('flow-temp penalty ×' + flowFactor.toFixed(2));
  if (scaleFactor < 1)  notes.push('scaling penalty ×' + scaleFactor.toFixed(2));
  document.getElementById('effNote').textContent =
    notes.length ? 'Adjustments: ' + notes.join(', ') : '';
}

['sedbukInput', 'ageInput', 'flowTempInput', 'scaleInput'].forEach(id =>
  document.getElementById(id).addEventListener('input', calcRealEfficiency)
);

// ── Supply Pressure Monitor ────────────────────────────────────────────────
function calcPressureDrop() {
  const staticP  = parseFloat(document.getElementById('staticPressure').value);
  const dynamicP = parseFloat(document.getElementById('dynamicPressure').value);
  const el       = document.getElementById('pressureResult');

  if (isNaN(staticP) || isNaN(dynamicP)) { el.innerHTML = ''; return; }

  if (dynamicP > staticP) {
    el.innerHTML = '<span class="pdrop-invalid">⚠ Dynamic exceeds static — check readings</span>';
    return;
  }

  const drop = staticP - dynamicP;
  let cls, label;
  if      (drop < 0.20) { cls = 'pdrop-good'; label = 'Good supply'; }
  else if (drop < 0.50) { cls = 'pdrop-ok';   label = 'Adequate'; }
  else if (drop < 1.00) { cls = 'pdrop-warn'; label = 'Weak supply'; }
  else                  { cls = 'pdrop-bad';  label = 'Very weak supply'; }

  el.innerHTML =
    `<div class="pdrop-line">` +
    `<span class="pdrop-arrow">${staticP.toFixed(1)} &rarr; ${dynamicP.toFixed(1)} bar</span>` +
    `<span class="pdrop-badge ${cls}">Drop: ${drop.toFixed(2)} bar &mdash; ${label}</span>` +
    `</div>`;
}

['staticPressure', 'dynamicPressure'].forEach(id =>
  document.getElementById(id).addEventListener('input', calcPressureDrop)
);

// More? modal
const backdrop = document.getElementById('modalBackdrop');
const focusableSelectors = 'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])';

function openModal() {
  backdrop.classList.add('open');
  const focusable = backdrop.querySelectorAll(focusableSelectors);
  if (focusable.length) focusable[0].focus();
}

function closeModal() {
  backdrop.classList.remove('open');
  document.getElementById('moreBtn').focus();
}

document.getElementById('moreBtn').addEventListener('click', openModal);
document.getElementById('modalClose').addEventListener('click', closeModal);
backdrop.addEventListener('click', e => { if (e.target === backdrop) closeModal(); });
document.addEventListener('keydown', e => {
  if (e.key === 'Escape' && backdrop.classList.contains('open')) closeModal();
});

// Initial render
render();
calcRealEfficiency();
</script>

</body>
</html>
